# model: gpt-oss:latest
# prompt: <system>ä½ æ˜¯ä¸€ä¸ªPythonä¸“å®¶</system>
<question>è¯·ç”¨Python å®ç°ä¸€ä¸ªè„šæœ¬å·¥å…·é›†æ¡†æ¶ï¼Œè¦æ±‚å®ç°åŸºæœ¬çš„æ–‡ä»¶è¯»å–å’Œå†™å…¥èƒ½åŠ›</question>
# answer: 
 thinking:

We need to produce a Python script toolset framework that implements basic file reading and writing capabilities. Likely a simple CLI tool or a library with functions. They want a "è„šæœ¬å·¥å…·é›†æ¡†æ¶" i.e., script toolset framework, with basic file read/write. Provide example usage, maybe use argparse, support read, write, maybe command grouping.

We should provide a design with classes, maybe a base Tool class, a Registry, and implement FileTool with read/write commands. Use argparse for command line. Provide code and explanation.

Also mention possible extension. Provide the script file.

Let's produce a single Python file named toolset.py, containing classes:

- BaseTool
- FileTool (implements read, write)
- ToolRegistry
- main function

Also explain how to run: python toolset.py read <path>, write <path> <content>.

Also show test example.

Make sure to include proper error handling.

Let's produce the code with comments, docstrings.

We can also show how to add new tools.

Ok.

thinking end 

ä¸‹é¢ç»™å‡ºä¸€ä¸ª**Python è„šæœ¬å·¥å…·é›†æ¡†æ¶**çš„å®Œæ•´å®ç°ã€‚  
å®ƒå…·å¤‡ï¼š

| ä¸»è¦åŠŸèƒ½ | è¯´æ˜ |
|----------|------|
| è¯»å–æ–‡ä»¶ | `read <æ–‡ä»¶è·¯å¾„>` |
| å†™å…¥æ–‡ä»¶ | `write <æ–‡ä»¶è·¯å¾„> <å†…å®¹>` |
| æ¨¡å—åŒ–æ‰©å±• | é€šè¿‡ `BaseTool` ä¸ `ToolRegistry` å¯éšæ—¶æ·»åŠ æ–°å·¥å…· |
| å‘½ä»¤è¡Œè§£æ | ä½¿ç”¨æ ‡å‡†åº“ `argparse`ï¼Œæ”¯æŒ `--help` è‡ªåŠ¨ç”Ÿæˆå¸®åŠ©æ–‡æ¡£ |

> **æ–‡ä»¶å**ï¼š`toolset.py`  
> **è¿è¡Œæ–¹å¼**ï¼š  
> ```bash
> python toolset.py read /path/to/file.txt
> python toolset.py write /path/to/file.txt "è¦å†™å…¥çš„å†…å®¹"
> ```

---

## ä»£ç å®ç°

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
toolset.py
~~~~~~~~~~

ä¸€ä¸ªæç®€çš„è„šæœ¬å·¥å…·é›†æ¡†æ¶ï¼Œå†…ç½®æ–‡ä»¶è¯»å–/å†™å…¥åŠŸèƒ½ï¼Œåç»­å¯æŒ‰éœ€æ‰©å±•æ–°å·¥å…·ã€‚

ä½¿ç”¨æ–¹å¼ï¼š
    python toolset.py read <æ–‡ä»¶è·¯å¾„>
    python toolset.py write <æ–‡ä»¶è·¯å¾„> <å†…å®¹>
"""

from __future__ import annotations

import argparse
import sys
from abc import ABC, abstractmethod
from pathlib import Path
from typing import Callable, Dict, List, Type


# --------------------------------------------------------------------------- #
# 1. å·¥å…·åŸºç±»ä¸å·¥å…·æ³¨å†Œæœºåˆ¶
# --------------------------------------------------------------------------- #

class BaseTool(ABC):
    """
    æ‰€æœ‰å·¥å…·å¿…é¡»ç»§æ‰¿æ­¤åŸºç±»ã€‚

    æ¯ä¸ªå·¥å…·éƒ½åº”è¯¥å®ç° `run(args: argparse.Namespace) -> int` æ–¹æ³•ï¼Œ
    å…¶ä¸­ `args` æ˜¯é€šè¿‡ argparse è§£æåçš„å‚æ•°å¯¹è±¡ã€‚
    è¿”å›å€¼ä¸ºç¨‹åºé€€å‡ºç ï¼ˆ0 è¡¨ç¤ºæˆåŠŸï¼‰ã€‚
    """

    @abstractmethod
    def run(self, args: argparse.Namespace) -> int:
        """æ‰§è¡Œå·¥å…·ä¸»é€»è¾‘ã€‚"""


class ToolRegistry:
    """
    ç”¨äºæ³¨å†Œä¸æŸ¥æ‰¾å·¥å…·ã€‚å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªåç§° -> å·¥å…·ç±» çš„å­—å…¸ã€‚
    """

    _registry: Dict[str, Type[BaseTool]] = {}

    @classmethod
    def register(cls, name: str, tool_cls: Type[BaseTool]) -> None:
        if name in cls._registry:
            raise ValueError(f"Tool '{name}' å·²ç»è¢«æ³¨å†Œ")
        cls._registry[name] = tool_cls

    @classmethod
    def get(cls, name: str) -> Type[BaseTool]:
        return cls._registry[name]

    @classmethod
    def list_tools(cls) -> List[str]:
        return list(cls._registry.keys())


# --------------------------------------------------------------------------- #
# 2. å…·ä½“å·¥å…·å®ç°
# --------------------------------------------------------------------------- #

class ReadTool(BaseTool):
    """
    è¯»å–æ–‡ä»¶å†…å®¹å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚
    ç”¨æ³•ï¼š`read <æ–‡ä»¶è·¯å¾„>`
    """

    def run(self, args: argparse.Namespace) -> int:
        file_path = Path(args.file).expanduser().resolve()
        if not file_path.is_file():
            print(f"[é”™è¯¯] æ–‡ä»¶ä¸å­˜åœ¨ï¼š{file_path}", file=sys.stderr)
            return 1
        try:
            content = file_path.read_text(encoding=args.encoding)
        except Exception as e:
            print(f"[é”™è¯¯] è¯»å–æ–‡ä»¶å¤±è´¥ï¼š{e}", file=sys.stderr)
            return 1
        print(content)
        return 0


class WriteTool(BaseTool):
    """
    å†™å…¥æ–‡æœ¬åˆ°æ–‡ä»¶ã€‚è‹¥æ–‡ä»¶ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºã€‚
    ç”¨æ³•ï¼š`write <æ–‡ä»¶è·¯å¾„> <å†…å®¹>`
    """

    def run(self, args: argparse.Namespace) -> int:
        file_path = Path(args.file).expanduser().resolve()
        try:
            file_path.write_text(args.content, encoding=args.encoding)
        except Exception as e:
            print(f"[é”™è¯¯] å†™å…¥æ–‡ä»¶å¤±è´¥ï¼š{e}", file=sys.stderr)
            return 1
        print(f"[æˆåŠŸ] å·²å†™å…¥ {file_path}")
        return 0


# æ³¨å†Œå·¥å…·
ToolRegistry.register("read", ReadTool)
ToolRegistry.register("write", WriteTool)


# --------------------------------------------------------------------------- #
# 3. å‘½ä»¤è¡Œè§£æä¸å…¥å£
# --------------------------------------------------------------------------- #

def build_main_parser() -> argparse.ArgumentParser:
    """æ„é€ ä¸»è§£æå™¨ï¼ˆå«å­å‘½ä»¤ï¼‰ã€‚"""
    parser = argparse.ArgumentParser(
        description="Python è„šæœ¬å·¥å…·é›†æ¡†æ¶ï¼ˆæ–‡ä»¶è¯»å–/å†™å…¥ï¼‰",
        formatter_class=argparse.ArgumentDefaultsHelpFormatter,
    )
    subparsers = parser.add_subparsers(dest="command", required=True)

    # ---- read ----
    read_parser = subparsers.add_parser(
        "read",
        help="è¯»å–æ–‡ä»¶å†…å®¹å¹¶æ‰“å°",
    )
    read_parser.add_argument(
        "file",
        help="å¾…è¯»å–çš„æ–‡ä»¶è·¯å¾„",
    )
    read_parser.add_argument(
        "--encoding",
        default="utf-8",
        help="æ–‡ä»¶ç¼–ç ",
    )
    read_parser.set_defaults(func=ReadTool().run)

    # ---- write ----
    write_parser = subparsers.add_parser(
        "write",
        help="å†™å…¥æ–‡æœ¬åˆ°æ–‡ä»¶",
    )
    write_parser.add_argument(
        "file",
        help="ç›®æ ‡æ–‡ä»¶è·¯å¾„",
    )
    write_parser.add_argument(
        "content",
        help="è¦å†™å…¥çš„æ–‡æœ¬å†…å®¹",
    )
    write_parser.add_argument(
        "--encoding",
        default="utf-8",
        help="å†™å…¥æ—¶ä½¿ç”¨çš„ç¼–ç ",
    )
    write_parser.set_defaults(func=WriteTool().run)

    # ---- å¯æ‰©å±•æ€§ç¤ºä¾‹ï¼ˆè‡ªå®šä¹‰å·¥å…·ï¼‰ ----
    # ä¸‹é¢ä»£ç æ¼”ç¤ºå¦‚ä½•åœ¨åŒä¸€æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªæ–°å·¥å…·å¹¶æ³¨å†Œ
    # class EchoTool(BaseTool):
    #     def run(self, args):
    #         print(args.message)
    #         return 0
    # ToolRegistry.register("echo", EchoTool)
    # echo_parser = subparsers.add_parser("echo", help="ç®€å•å›æ˜¾")
    # echo_parser.add_argument("message", help="è¦å›æ˜¾çš„æ¶ˆæ¯")
    # echo_parser.set_defaults(func=EchoTool().run)

    return parser


def main() -> None:
    """è„šæœ¬å…¥å£ã€‚"""
    parser = build_main_parser()
    args = parser.parse_args()
    # `args.func` æ˜¯æ¯ä¸ªå­å‘½ä»¤æ³¨å†Œçš„ `run` æ–¹æ³•
    exit_code = args.func(args)
    sys.exit(exit_code)


# --------------------------------------------------------------------------- #
# 4. ç›´æ¥è¿è¡Œæ—¶è°ƒç”¨ main()
# --------------------------------------------------------------------------- #

if __name__ == "__main__":
    main()
```

---

## è¯´æ˜ä¸æ‰©å±•

### 1. è¿è¡Œç¤ºä¾‹

```bash
# è¯»å–æ–‡ä»¶
$ python toolset.py read README.md
# æ–‡ä»¶å†…å®¹ä¼šç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯

# å†™å…¥æ–‡ä»¶
$ python toolset.py write ./tmp/hello.txt "Hello, world!"
[æˆåŠŸ] å·²å†™å…¥ /absolute/path/tmp/hello.txt
```

### 2. å¦‚ä½•æ·»åŠ æ–°å·¥å…·

1. **å®šä¹‰ç±»**  
   ```python
   class MyTool(BaseTool):
       def run(self, args):
           # ä½ çš„å®ç°
           return 0
   ```

2. **æ³¨å†Œå·¥å…·**  
   ```python
   ToolRegistry.register("mytool", MyTool)
   ```

3. **æ·»åŠ å‘½ä»¤è¡Œå­è§£æå™¨**  
   ```python
   my_parser = subparsers.add_parser("mytool", help="è‡ªå®šä¹‰å·¥å…·è¯´æ˜")
   my_parser.add_argument(... )   # æ ¹æ®éœ€è¦æ·»åŠ å‚æ•°
   my_parser.set_defaults(func=MyTool().run)
   ```

è¿™æ ·ï¼Œåªè¦é‡å¯è„šæœ¬å³å¯ä½¿ç”¨ `mytool` å‘½ä»¤ã€‚

### 3. ä»£ç ç»„ç»‡å»ºè®®

- è‹¥å·¥å…·æ•°ç›®å¢å¤šï¼Œå»ºè®®æ‹†åˆ†æˆå¤šä¸ªæ–‡ä»¶ï¼ˆå¦‚ `tools/read.py`, `tools/write.py`ï¼‰ï¼Œå†åœ¨ä¸»æ–‡ä»¶ä¸­ç»Ÿä¸€å¯¼å…¥å¹¶æ³¨å†Œã€‚
- è‹¥éœ€è¦åœ¨ä¸åŒé¡¹ç›®å…±äº«åŒä¸€å·¥å…·é›†ï¼Œå¯å°†å…¶æ‰“åŒ…æˆ Python åŒ…ï¼ˆ`setup.py` / `pyproject.toml`ï¼‰ï¼Œç„¶å `pip install -e .` å¼€å‘ä½¿ç”¨ã€‚

---

## ç»“è¯­

ä¸Šè¿°æ¡†æ¶å…¼é¡¾ **ç®€æ´** ä¸ **å¯æ‰©å±•**ï¼š  
- åŸºç¡€åŠŸèƒ½ï¼ˆè¯»å–/å†™å…¥ï¼‰å·²å®Œæˆã€‚  
- é€šè¿‡ `BaseTool` ä¸ `ToolRegistry`ï¼Œä½ å¯ä»¥åœ¨æœªæ¥è½»æ¾æ·»åŠ æ›´å¤šå‘½ä»¤ã€‚  

å¦‚æœä½ åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæˆ–è€…æƒ³è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆä¾‹å¦‚æ”¯æŒäºŒè¿›åˆ¶æ–‡ä»¶ã€æ·»åŠ æ—¥å¿—ã€åšå¤šçº¿ç¨‹ç­‰ï¼‰ï¼Œéšæ—¶å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç»§ç»­å®Œå–„ã€‚ç¥ä½ ç¼–ç æ„‰å¿« ğŸš€thinking:


